---
  - name: Create Vnet Peering between Ansilbe Instance and {{az_rgname}} Vnet
    hosts: localhost
    connection: local
    gather_facts: no
    vars:
       az_rgname: ''
       AZURE_CLIENT_ID: ''
       AZURE_SECRET: ''
       AZURE_SUBSCRIPTION_ID: ''
       AZURE_TENANT: ''
    tasks:
      - name: Creating Peering from Ansible node to {{az_rgname}} Network
        azure_rm_virtualnetworkpeering:
          resource_group: ansbile_workspace
          virtual_network: ansbile_workspace-vnet
          name: "{{'ansiblevnet_to_'}}{{az_rgname}}"
          remote_virtual_network:
            resource_group: "{{az_rgname}}"
            name: "{{az_rgname}}"
          allow_virtual_network_access: true
          allow_forwarded_traffic: true
          state: present
      - name: Creating Peering from {{az_rgname}} Network to Ansible node
        azure_rm_virtualnetworkpeering:
          resource_group: "{{az_rgname}}"
          virtual_network: "{{az_rgname}}"
          name: "{{az_rgname}}{{'_to_ansiblevnet'}}"
          remote_virtual_network:
            resource_group: ansbile_workspace
            name: ansbile_workspace-vnet
          allow_virtual_network_access: true
          allow_forwarded_traffic: true
          state: present
        debug:
          msg: You should be able to ping now!!!!
